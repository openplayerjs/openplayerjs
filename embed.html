<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="OpenPlayerJS is an ever-green lightweight media player that supports the most common video/audio files for the web, and also VAST/VPAID/VMAP Ads" />
    <meta name="google-site-verification" content="Desj0WKx8CJ5bVxUndGN6WP9k80dxk7fZg0ChsKmIno" />
    <title>OpenPlayerJS - The Lighweight Media Player for Web</title>

    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/openplayerjs@latest/dist/openplayer.min.css" />
    <style>
      body {
        background: #000;
        color: #fff;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #media {
        width: 100%;
        padding: 20px 0;
      }
    </style>
  </head>

  <body>
    <div id="media"></div>
    <script src="https://cdn.jsdelivr.net/npm/openplayerjs@latest/dist/openplayer.min.js"></script>
    <script>  
      const getUrlParameter = (name) => {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        const results = regex.exec(location.search);
        return results === null
          ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      const type = getUrlParameter("type");
      const getMimeType = (url) => {
        if (/\.m3u8/i.test(url)) {
          return "application/x-mpegURL";
        } else if (/\.mpd/i.test(url)) {
          return "application/dash+xml";
        } else if (/\.mp4/i.test(url)) {
          return type === "audio" ? "audio/mp4" : "video/mp4";
        } else if (/\.mp3/i.test(url)) {
          return "audio/mp3";
        } else if (/\.webm/i.test(url)) {
          return type === "audio" ? "audio/webm" : "video/webm";
        } else if (/\.ogg/i.test(url)) {
          return type === "audio" ? "audio/ogg" : "video/ogg";
        } else if (/\.ogv/i.test(url)) {
          return "video/ogg";
        } else if (/\.oga/i.test(url)) {
          return "audio/ogg";
        } else if (/\.3gp/i.test(url)) {
          return "audio/3gpp";
        } else if (/\.wav/i.test(url)) {
          return "audio/wav";
        } else if (/\.aac/i.test(url)) {
          return "audio/aac";
        } else if (/\.flac/i.test(url)) {
          return "audio/flac";
        }

        // Let browser figure out if it can play it
        return "";
      }

      const ads = getUrlParameter('ads').replace(/~/g, '%');
      const poster = getUrlParameter('poster').replace(/~/g, '%');

      const addLevels = !!getUrlParameter('levels');
      const rightControls = ['captions', 'settings', 'fullscreen'];
      if (addLevels) {
        rightControls.splice(0, 0, 'levels');
      }

      const defaultMedia =
        'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4';

      const url = decodeURIComponent(getUrlParameter('file')) || defaultMedia;
      const media = document.createElement(type);
      media.id = 'media1';
      media.setAttribute('playsinline', true);
      if (poster) {
        media.setAttribute('poster', poster);
      }
      media.controls = true;
      media.playsinline = true;
      media.className = 'op-player__media';
      media.innerHTML = `<source src="${url}" type="${getMimeType(url)}">`;
      document.getElementById('media').appendChild(media);

      document.addEventListener('DOMContentLoaded', (event) => {
        const player = new OpenPlayerJS('media1', {
          ads: {
            src: ads || null,
          },
          controls: {
            layers: {
              left: ['play', 'time', 'volume'],
              middle: ['progress'],
              right: rightControls,
            }
          },
        });

        player.init();
      }); 
    </script>
  </body>
</html>
